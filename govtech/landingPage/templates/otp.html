{% load static %}
<!DOCTYPE html>
<html lang="en">
<!-- [Head] start -->

<head>
  <title>Verify OTP | MOICDE</title>
  <!-- [Meta] -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- [Favicon] icon -->
  <link rel="icon" href="{% static 'images/cos.ico' %}" type="image/x-icon"> <!-- [Google Font] Family -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&display=swap"
    id="main-font-link">
  <!-- [Tabler Icons] https://tablericons.com -->
  <link rel="stylesheet" href="{% static 'fonts/tabler-icons.min.css' %}">
  <!-- [Feather Icons] https://feathericons.com -->
  <link rel="stylesheet" href="{% static 'fonts/feather.css' %}">
  <!-- [Font Awesome Icons] https://fontawesome.com/icons -->
  <link rel="stylesheet" href="{% static 'fonts/fontawesome.css' %}">
  <!-- [Material Icons] https://fonts.google.com/icons -->
  <link rel="stylesheet" href="{% static 'fonts/material.css' %}">
  <!-- [Template CSS Files] -->
  <link rel="stylesheet" href="{% static 'css/style.css' %}" id="main-style-link">
  <link rel="stylesheet" href="{% static 'css/style-preset.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">



</head>
<!-- [Head] end -->
<!-- [Body] Start -->
<style>
  .input-group .input-group-text {
  background-color: #fff;
  border-left: none;
  border-radius: 0 .25rem .25rem 0;
  display: flex;
  align-items: center;
  padding: 0 0.75rem;
  height: 100%;
}

.input-group input.form-control {
  border-right: none;
}

</style>

<body>
  <!-- [ Pre-loader ] start -->
  <div class="loader-bg">
    <div class="loader-track">
      <div class="loader-fill"></div>
    </div>
  </div>
  <!-- [ Pre-loader ] End -->

  <div class="auth-main">
    <div class="auth-wrapper v3">
      <div class="auth-form">
        <div class="auth-header">
          <a href="#"><img src="{% static 'images/COTlog.png' %}" alt="img"></a>
        </div>
        <form class="login-form" id="otpform" method="post" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="card my-5" style="width: 500px; max-width: 100%; margin: auto;">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-end mb-4">
                  <h3 class="mb-0"><b>Enter the OTP that was sent </b></h3>
                </div>
                <div class="form-group mb-3">
                   <label class="form-label">OTP</label>
                                <input type="text" class="form-control" name="otp" id="otp"
                                       placeholder="Enter your one time password" required>
                                <input type="hidden" name="email" id="emailField">
                </div>
                <div class="d-grid mt-4">
                  <button type="submit" class="btn btn-primary">Verify</button>
                </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- [ Main Content ] end -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
        const email = sessionStorage.getItem("otp_email");
        if (email) {
            document.getElementById("emailField").value = email;
        } else {
            alert("No email found in session. Please go back and try again.");
            window.location.href = "/forgetPassword/";
        }
    });
</script>
  <script>
    document.getElementById('otpform').addEventListener('submit', function(e) {
        e.preventDefault();  // Prevent default form submission

        const form = e.target;
        const formData = new FormData(form);  // Collect form data

        // Get CSRF token from the hidden input field (if it's in the form)
        const csrfToken = form.querySelector('[name="csrfmiddlewaretoken"]').value;

        fetch("{% url 'verifyOTP' %}", {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrfToken  // Send CSRF token in the header
            },
            body: formData  // Send the form data
        })
        .then(res => res.json())
        .then(data => {
            if (data.status === 'success') {
                Swal.fire({
                    icon: 'success',
                    title: 'Success',
                    text: data.message
                }).then(() => {
                  window.location.href = "/ChangePassword/";  // Redirect to Dashboard on success
                });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: data.message
                });
            }
        })
        .catch(error => console.log(error));
    });
</script>


  <!-- Required Js -->
  <script src="{% static 'js/plugins/popper.min.js' %}"></script>
  <script src="{% static 'js/plugins/simplebar.min.js' %}"></script>
  <script src="{% static 'js/plugins/bootstrap.min.js' %}"></script>
  <script src="{% static 'js/fonts/custom-font.js' %}"></script>
  <script src="{% static 'js/pcoded.js' %}"></script>
  <script src="{% static 'js/plugins/feather.min.js' %}"></script>





  <script>layout_change('light');</script>




  <script>change_box_container('false');</script>



  <script>layout_rtl_change('false');</script>


  <script>preset_change("preset-1");</script>


  <script>font_change("Public-Sans");</script>



</body>
<!-- [Body] end -->

</html>