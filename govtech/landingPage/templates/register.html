{% load static %}
<!DOCTYPE html>
<html lang="en">
<!-- [Head] start -->

<head>
    <title>Sign Up | MOICDE</title>
    <!-- [Meta] -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- [Favicon] icon -->
    <link rel="icon" href="{% static 'images/cos.ico' %}" type="image/x-icon"> <!-- [Google Font] Family -->
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&display=swap"
          id="main-font-link">
    <!-- [Tabler Icons] https://tablericons.com -->
    <link rel="stylesheet" href="{% static 'fonts/tabler-icons.min.css' %}">
    <!-- [Feather Icons] https://feathericons.com -->
    <link rel="stylesheet" href="{% static 'fonts/feather.css' %}">
    <!-- [Font Awesome Icons] https://fontawesome.com/icons -->
    <link rel="stylesheet" href="{% static 'fonts/fontawesome.css' %}">
    <!-- [Material Icons] https://fonts.google.com/icons -->
    <link rel="stylesheet" href="{% static 'fonts/material.css' %}">
    <!-- [Template CSS Files] -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}" id="main-style-link">
    <link rel="stylesheet" href="{% static 'css/style-preset.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>
<!-- [Head] end -->
<!-- [Body] Start -->
<style>
    .input-group .input-group-text {
        background-color: #fff;
        border-left: none;
        border-radius: 0 .25rem .25rem 0;
        display: flex;
        align-items: center;
        padding: 0 0.75rem;
        height: 100%;
    }

    .input-group input.form-control {
        border-right: none;
    }

</style>

<body>
<!-- [ Pre-loader ] start -->
<div class="loader-bg">
    <div class="loader-track">
        <div class="loader-fill"></div>
    </div>
</div>
<!-- [ Pre-loader ] End -->

<div class="auth-main">
    <div class="auth-wrapper v3">
        <div class="auth-form">
            <div class="auth-header">
                <a href="#"><img src="{% static 'images/COTlog.png' %}" alt="img">
                <a href="#"><img src="{% static 'img/devlink-logo.png' %}" alt="DevLink Logo" style="height: 100px; "></a>
            </div>
            <form class="login-form" id="registerForm" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="card my-5" style="width: 1000px; max-width: 100%; margin: auto;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-end mb-4">
                            <h3 class="mb-0"><b>Sign Up</b></h3>
                        </div>
                        <br>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">First Name</label>
                                <input type="text" class="form-control" name="first_name"
                                       placeholder="Enter your First Name" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Surname</label>
                                <input type="text" class="form-control" name="last_name"
                                       placeholder="Enter your Surname" required>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" name="email" id="emailInput"
                                       placeholder="Enter your email address" required>
                                <small id="emailFeedback" class="form-text"></small>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" name="phone"
                                       placeholder="Enter your phone number (+254712345678 or 0712345678)" required>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Nationality</label>
                                <select class="form-control" name="nationality" required>
                                    <option value="">-- Select Nationality --</option>
                                    {% for country in countries %}
                                        <option value="{{ country.id }}">{{ country.nationality }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">County</label>
                                <select id="county" name="county" class="form-control" required>
                                    <option value="">-- Select County --</option>
                                    {% for c in counties %}
                                        <option value="{{ c.id }}">{{ c.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Subcounty</label>
                                <select id="subcounty" name="subcounty" class="form-control" required>
                                    <option value="">-- Select Subcounty --</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Gender</label>
                                <select class="form-control" name="gender" required>
                                    <option value="">-- Select Gender --</option>
                                    {% for mygender in genders %}
                                        <option value="{{ mygender.id }}">{{ mygender.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Password</label>
                                <div class="input-group">
                                    <input type="password" id="password" class="form-control" name="password"
                                           placeholder="Enter password" required>
                                    <div class="input-group-append">
                                        <span class="input-group-text" id="togglePassword" style="cursor: pointer;">
                                            <i class="fa-solid fa-eye" id="togglePasswordIcon"></i>
                                        </span>
                                    </div>
                                </div>
                                <small id="passwordHelp" class="form-text text-muted">Must be at least 8 characters,
                                    include a capital letter, number, and symbol.</small>
                                <div id="passwordStrength" class="mt-1"></div>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Confirm Password</label>
                                <div class="input-group">
                                    <input type="password" id="confirm_password" class="form-control"
                                           name="confirm_password" placeholder="Confirm password" required>
                                    <div class="input-group-append">
                                        <span class="input-group-text" id="toggleConfirmPassword"
                                              style="cursor: pointer;">
                                            <i class="fa-solid fa-eye" id="toggleConfirmPasswordIcon"></i>
                                        </span>
                                    </div>
                                </div>
                                <small id="matchMessage" class="form-text"></small>
                            </div>

                        </div>
                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-primary">Sign Up</button>
                        </div>
                    </div>

                </div>
            </form>
        </div>
    </div>
</div>
<!-- [ Main Content ] end -->
<!-- Required Js -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- SweetAlert2 CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.getElementById('registerForm').addEventListener('submit', function (e) {
        e.preventDefault();  // Prevent default form submission

        const form = e.target;
        const formData = new FormData(form);  // Collect form data

        fetch("{% url 'signup' %}", {
            method: 'POST',
            headers: {
                'X-CSRFToken': formData.get('csrfmiddlewaretoken')  // Send CSRF token
            },
            body: formData  // Send the form data
        })
            .then(res => res.json())
            .then(data => {
                if (data.status === 'success') {
                    Swal.fire({
                        icon: 'success',
                        title: 'Success',
                        text: data.message
                    }).then(() => {
                        window.location.href = "{% url 'login' %}";  // Redirect to login on success
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: data.message
                    });
                }
            });
    });
</script>

<script>
    $('#county').on('change', function () {
        var countyId = $(this).val();

        if (countyId) {
            $.ajax({
                url: '/get-subcounties/',
                data: {
                    'county_id': countyId
                },
                success: function (data) {
                    $('#subcounty').empty().append('<option value="">-- Select Subcounty --</option>');
                    $.each(data, function (i, item) {
                        $('#subcounty').append($('<option>', {
                            value: item.id,
                            text: item.name
                        }));
                    });
                }
            });
        } else {
            $('#subcounty').empty().append('<option value="">-- Select Subcounty --</option>');
        }
    });
</script>
<script>
    // Toggle password visibility
    $('#togglePassword').on('click', function () {
        const input = $('#password');
        const icon = $('#togglePasswordIcon');
        const type = input.attr('type') === 'password' ? 'text' : 'password';
        input.attr('type', type);
        icon.toggleClass('fa-eye fa-eye-slash');
    });

    $('#toggleConfirmPassword').on('click', function () {
        const input = $('#confirm_password');
        const icon = $('#toggleConfirmPasswordIcon');
        const type = input.attr('type') === 'password' ? 'text' : 'password';
        input.attr('type', type);
        icon.toggleClass('fa-eye fa-eye-slash');
    });

    // Password strength checker
    $('#password').on('input', function () {
        const password = $(this).val();
        const strength = getPasswordStrength(password);
        const strengthDiv = $('#passwordStrength');

        let color, message;
        switch (strength) {
            case 0:
                color = 'danger';
                message = 'Too weak';
                break;
            case 1:
                color = 'warning';
                message = 'Weak';
                break;
            case 2:
                color = 'info';
                message = 'Moderate';
                break;
            case 3:
                color = 'primary';
                message = 'Strong';
                break;
            case 4:
                color = 'success';
                message = 'Very strong';
                break;
        }

        strengthDiv.html(`<div class="progress">
                <div class="progress-bar bg-${color}" role="progressbar" style="width: ${(strength + 1) * 20}%"></div>
            </div><small class="text-${color}">${message}</small>`);
    });

    function getPasswordStrength(password) {
        let score = 0;
        if (password.length >= 8) score++;
        if (/[A-Z]/.test(password)) score++;
        if (/[0-9]/.test(password)) score++;
        if (/[^A-Za-z0-9]/.test(password)) score++;
        return score;
    }

    // Password match validation
    $('#password, #confirm_password').on('input', function () {
        const password = $('#password').val();
        const confirmPassword = $('#confirm_password').val();
        const messageEl = $('#matchMessage');

        if (confirmPassword.length === 0) {
            messageEl.text('');
            return;
        }

        if (password === confirmPassword) {
            messageEl.text('Passwords match').removeClass().addClass('form-text text-success');
        } else {
            messageEl.text('Passwords do not match').removeClass().addClass('form-text text-danger');
        }
    });
</script>
<script>
    const emailInput = document.getElementById('emailInput');
    const emailFeedback = document.getElementById('emailFeedback');

    emailInput.addEventListener('input', function () {
        const email = this.value;
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;

        if (!email) {
            emailFeedback.textContent = '';
            emailFeedback.className = 'form-text';
        } else if (emailRegex.test(email)) {
            emailFeedback.textContent = 'Looks good!';
            emailFeedback.className = 'form-text text-success';
        } else {
            emailFeedback.textContent = 'Please enter a valid email like name@example.com';
            emailFeedback.className = 'form-text text-danger';
        }
    });
</script>


</script>
<script src="{% static 'js/plugins/popper.min.js' %}"></script>
<script src="{% static 'js/plugins/simplebar.min.js' %}"></script>
<script src="{% static 'js/plugins/bootstrap.min.js' %}"></script>
<script src="{% static 'js/fonts/custom-font.js' %}"></script>
<script src="{% static 'js/pcoded.js' %}"></script>
<script src="{% static 'js/plugins/feather.min.js' %}"></script>


<script>layout_change('light');</script>


<script>change_box_container('false');</script>


<script>layout_rtl_change('false');</script>


<script>preset_change("preset-1");</script>


<script>font_change("Public-Sans");</script>


</body>
<!-- [Body] end -->

</html>